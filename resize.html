<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>`</title>

	<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
	<link rel="stylesheet" type="text/css" href="css/font-awesome-ie7.min.css">
	<link rel="stylesheet" type="text/css" href="css/bootstrap.css"/>
		<script type="text/javascript" src="js/lib/jquery.js"></script>
	<script type="text/javascript" src="js/lib/jquery-ui-1.9.2.custom.min.js"></script>
	<style type="text/css">
	.rotate-rightTop{
		    position: absolute;
		    right: 50%;
		    margin-right: -7px;
		    top: -27px;
	}

	.ui-selected > [class^="m"], .ui-selecting > [class^="m"], .ui-draggable-dragging > [class^="m"],.active > [class^="m"]{
		position: absolute;
	    top: 0;
	    right: 0;
	    bottom: 0;
	    left: 0;
	    outline: 1px solid #81a3ea;
	    cursor: default;
	}
.ui-selected >.ui-resizable-handle {
    display: block;
    position: absolute;
    width: 8px;
    height: 8px;
    z-index: 10000;
    border-radius: 6px;
    background: #2570ba !important;
    background: -moz-linear-gradient(top,#92b9ea,#2570ba) !important;
    background: -webkit-gradient(linear,0 0,0 100%,from(#92b9ea),to(#2570ba)) !important;
    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff92b9ea',endColorstr='#ff2570ba',GradientType=0) !important;
    border: 1px solid #fff;
    box-shadow: 1px 1px 2px rgba(0,0,0,0.2);
}

.ui-resizable-s {
    cursor: s-resize;
    height: 7px;
    width: 7px;
    bottom: -5px;
    left: 50%;
    margin-left: -5px;
}

.ui-resizable-n {
    cursor: n-resize;
    height: 7px;
    width: 7px;
    top: -5px;
    left: 50%;
    margin-left: -5px;
}

.ui-resizable-e {
    cursor: e-resize;
    width: 7px;
    right: -5px;
    top: 50%;
    height: 7px;
    margin-top: -5px;
}

.ui-resizable-w {
    cursor: w-resize;
    width: 7px;
    left: -5px;
    top: 50%;
    height: 7px;
    margin-top: -5px;
}

.ui-resizable-se {
    cursor: se-resize;
    width: 7px;
    height: 7px;
    right: -5px;
    bottom: -5px;
}
.ui-resizable-sw {
    cursor: sw-resize;
    width: 7px;
    height: 7px;
    left: -5px;
    bottom: -5px;
}


.ui-resizable-ne {
    cursor: ne-resize;
    width: 7px;
    height: 7px;
    right: -5px;
    top: -5px;
}

.ui-resizable-nw {
    cursor: nw-resize;
    width: 7px;
    height: 7px;
    left: -5px;
    top: -5px;
}
.ui-selected > .rotate-rightTop {
	display: block;
    position: absolute;
    right: 50%;
    margin-right: -7px;
    top: -27px;
    cursor: url(./images/rotate_cursor.png),auto;
    display: block;
}
	</style>
</head>
<body>
<div id="selectable">
<div class="selected ui-widget-content" style="width:300px;height:300px;background:#ccc; position:absolute;">
	<div class="rotate-location rotate-rightTop"><i class="icon-undo"></i></div>
	<div class="mImage" style='position: absolute; width: 100%; height: 100%;overflow: hidden; border: 0px none rgb(0, 0, 0); border-radius: 0px; background-image: url("http://qn.media.epub360.com/materials/origin/0058c9bd7a9b553e55447b69e7d77db0_origin.jpg"); '>
</div>
</div>


</div>
	

	<script type="text/javascript">
		$(document).ready(function(){


$('.rotate-rightTop').on('mouseover',function(){
	$(this).css('display','block');
	
})

applyRotation();

function applyRotation() {
    $('.rotate-rightTop').draggable({
        opacity: 0.01,
        helper: 'clone',
        drag: function (event, ui) {
            var rotateCSS = 'rotate(' + ui.position.left + 'deg)';

            $(this).parent().css({
                '-moz-transform': rotateCSS,
                    '-webkit-transform': rotateCSS
            });
        }
    });
}





$(document).on('click',function(e){
	console.log($(e.target).closest("ui-selected").length+"length");
	if($(e.target).closest("ui-selected").length == 0){
		$(".ui-selected").removeClass('ui-selected');
		$(".rotate-rightTop").css('display','none');
	}
	
})


		// this creates the selected variable
// we are going to store the selected objects in here
var selected = $([]), offset = {top:0, left:0}; 

$( "#selectable > div" ).draggable({
    start: function(ev, ui) {
    	// ev.stopPropagation();
    	console.log('s');
        if ($(this).hasClass("ui-selected")){
        	console.log('drag')
            selected = $(".ui-selected").each(function() {
               var el = $(this);
               el.data("offset", el.offset());
            });
        }
        else {
            selected = $([]);
            $("#selectable > div").removeClass("ui-selected");
        }
        offset = $(this).offset();
    },
    drag: function(ev, ui) {
        var dt = ui.position.top - offset.top, dl = ui.position.left - offset.left;
        selected.not(this).each(function() {
        var el = $(this), off = el.data("offset");
        el.css({top: off.top + dt, left: off.left + dl});
        });
    }
}).resizable({ handles: 'n, e, s, w,se,sw,ne,nw' });

$( "#selectable" ).selectable();

// manually trigger the "select" of clicked elements
$( "#selectable > div" ).on('mousedown click',function(e){
	$(".rotate-rightTop").css('display','block');
	console.log(e.metaKey+"///")
	event.stopPropagation();
    if (e.metaKey == false) {
        // if command key is pressed don't deselect existing elements
        $( "#selectable > div" ).removeClass("ui-selected");
        $(this).addClass("ui-selecting");
    }
    else {
        if ($(this).hasClass("ui-selected")) {
            // remove selected class from element if already selected
            $(this).removeClass("ui-selected");
        }
        else {
            // add selecting class if not
            $(this).addClass("ui-selecting");
        }
    }

    $( "#selectable" ).data("selectable")._mouseStop(null);
});

});
	</script>
</body>
</html>